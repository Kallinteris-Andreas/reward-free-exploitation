import numpy as np
import matplotlib.pyplot as plt

RUNS = 50  # Number of statistical runs
FILE_NAME = "figures/pendulum"

steps = np.load('results/CartPole-v1/DQN/run_0/evaluations.npz')['timesteps']

fig = plt.figure()
ax = fig.add_subplot(1, 1, 1)

for algorithm in ["A2C", "PPO", "TD3", "SAC"]:
    returns = np.average(np.array([np.load(f'results/InvertedPendulum-v4/{algorithm}/run_{run}/evaluations.npz')['results'][:steps.size] for run in range(RUNS)]), axis=2)
    returns_len = np.average(np.array([np.load(f'results/InvertedPendulum-v4/{algorithm}/run_{run}/evaluations.npz')['ep_lengths'][:steps.size] for run in range(RUNS)]), axis=2)
    returns_fix = np.average(np.array([np.load(f'results/InvertedPendulum-v5/{algorithm}/run_{run}/evaluations.npz')['results'][:steps.size] for run in range(RUNS)]), axis=2)
    returns_fix_len = np.average(np.array([np.load(f'results/InvertedPendulum-v5/{algorithm}/run_{run}/evaluations.npz')['ep_lengths'][:steps.size] for run in range(RUNS)]), axis=2)

    ax.plot(steps, np.average(returns_len, axis=0), "--", label=f'InvertedPendulum reward-free {algorithm}')
    ax.fill_between(steps, np.min(returns_len, axis=0), np.max(returns_len, axis=0), alpha=0.2)
    ax.plot(steps, np.average(returns_fix_len, axis=0), label=f'InvertedPendulum {algorithm}')
    ax.fill_between(steps, np.min(returns_fix_len, axis=0), np.max(returns_fix_len, axis=0), alpha=0.2)


ax.set_title('SB3 on Gymnasium/MuJoCo/InvertedPendulum, for ' + str(RUNS) + ' Runs, episodic lenghts')
ax.legend()

fig.set_figwidth(16)
fig.set_figheight(9)

plt.savefig(FILE_NAME + ".eps", bbox_inches="tight")
plt.savefig(FILE_NAME + ".png", bbox_inches="tight")
plt.savefig(FILE_NAME + ".pdf", bbox_inches="tight")
